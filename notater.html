<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>History Go – Mine notater</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="theme.css">
</head>
<body>

  <main class="main">
    <header style="margin-bottom:1rem;">
      <a href="profile.html" style="color:var(--muted); text-decoration:none;">← Tilbake til profilen</a>
      <h1>Mine notater</h1>
  <p class="muted">
  Her ser du notater du har skrevet i History Go – om personer, steder og andre ting du vil huske.
</p>
    </header>

    <section id="notesRoot">
      <p class="muted">Laster notater …</p>
    </section>
  </main>

  <script>
    function loadNotes() {
      const root = document.getElementById("notesRoot");
      let notes = [];
      try {
        const raw = localStorage.getItem("hg_person_notes_v1");
        notes = raw ? JSON.parse(raw) : [];
      } catch (e) {
        console.warn("Kunne ikke lese notater", e);
      }

      if (!notes || !notes.length) {
        root.innerHTML = "<p class='muted'>Du har ingen notater ennå.</p>";
        return;
      }

      // sortér nyeste først
      notes.sort((a, b) => (b.createdAt || "").localeCompare(a.createdAt || ""));

      // prøv å hente personnavn fra people.json
      fetch("people.json")
        .then(r => r.json())
        .then(people => {
          const map = {};
          (people || []).forEach(p => { map[p.id] = p.name; });
          renderNotes(root, notes, map);
        })
        .catch(() => {
          renderNotes(root, notes, {});
        });
    }

    function renderNotes(root, notes, peopleMap) {
      const cards = notes.map(n => {
        const name = peopleMap[n.personId] || "Ukjent person";
        const date = n.createdAt ? new Date(n.createdAt).toLocaleString("no-NO") : "";
        const catLabel = n.categoryId ? n.categoryId.toUpperCase() : "";

        return `
          <article class="card">
            <div class="row between">
              <div>
                <div class="name">${n.title || ("Notat om " + name)}</div>
                <div class="meta">
                  ${name}${catLabel ? " · " + catLabel : ""} · ${date}
                </div>
              </div>
            </div>
            <p style="margin-top:8px;">${escapeHtml(n.text || "")}</p>
          </article>
        `;
      }).join("");

      root.innerHTML = `
        <section class="cards">
          ${cards}
        </section>
      `;
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    document.addEventListener("DOMContentLoaded", loadNotes);
  </script>

</body>
</html>
