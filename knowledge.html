<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>History Go – Din kunnskapsprofil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="knowledge.css">
</head>

<body class="knowledge-page">

  <header class="knowledge-header">
    <a class="back-link" href="profile.html">← Tilbake til profil</a>

    <img src="bilder/ui/historygo_logo.PNG" class="knowledge-logo">

    <h1>Din kunnskapsprofil</h1>
    <p>All kunnskapen du har låst opp gjennom quiz – sortert etter felt og dimensjon.</p>
  </header>

  <!-- FILTER -->
  <section class="knowledge-filters">
    <select id="filterCategory">
      <option value="">Alle felt</option>
    </select>

    <select id="filterDimension">
      <option value="">Alle dimensjoner</option>
    </select>
  </section>

  <main id="knowledgeContainer"></main>

  <script src="knowledge.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const box   = document.getElementById("knowledgeContainer");
      const catF  = document.getElementById("filterCategory");
      const dimF  = document.getElementById("filterDimension");

      // Hent universet vårt
      const uni = getKnowledgeUniverse();

      if (!uni || Object.keys(uni).length === 0) {
        box.innerHTML = `<div class="empty-note">Ingen kunnskap låst opp ennå.</div>`;
        return;
      }

      // --- Fyll kategori-filteret ---
      Object.keys(uni).forEach(cat => {
        const o = document.createElement("option");
        o.value = cat;
        o.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
        catF.appendChild(o);
      });

      // --- Fyll dimensjons-filteret ---
      const allDims = new Set();
      Object.values(uni).forEach(dimObj => {
        Object.keys(dimObj).forEach(d => allDims.add(d));
      });

      [...allDims].forEach(dim => {
        const o = document.createElement("option");
        o.value = dim;
        o.textContent = dim.charAt(0).toUpperCase() + dim.slice(1);
        dimF.appendChild(o);
      });

      // Hoved renderer
      function render() {
        const catSel = catF.value;
        const dimSel = dimF.value;

        let html = "";

        // Gå gjennom alle kategorier
        for (const [cat, dimObj] of Object.entries(uni)) {

          // Hopper over kategorier som ikke matcher filter
          if (catSel && catSel !== cat) continue;

          let catBlock = "";
          let hasContent = false;

          // Gå gjennom alle dimensjoner i kategorien
          for (const [dim, items] of Object.entries(dimObj)) {

            // Hopper over dimensjoner som ikke matcher filter
            if (dimSel && dimSel !== dim) continue;

            if (!items || !items.length) continue;

            hasContent = true;

            catBlock += `
              <div class="dimension-title">${dim}</div>
              ${items
                .map(item => `
                  <div class="knowledge-item">
                    <div class="knowledge-topic">${item.topic}</div>
                    <div class="knowledge-text">${item.text}</div>
                  </div>
                `)
                .join("")}
            `;
          }

          if (hasContent) {
            html += `
              <section class="know-cat-block">
                <h2>${cat}</h2>
                ${catBlock}
              </section>
            `;
          }
        }

        box.innerHTML = html || `<div class="empty-note">Ingen treff.</div>`;
      }

      // Koble filter
      catF.onchange = render;
      dimF.onchange = render;

      render();
    });
  </script>

</body>
</html>
