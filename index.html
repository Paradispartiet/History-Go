<!doctype html>
<html lang="nb">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>History Go</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/theme.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/search.css">
  <link rel="stylesheet" href="css/nearby.css">
  <link rel="stylesheet" href="css/miniProfile.css">
  <link rel="stylesheet" href="css/profile.css">
  <link rel="stylesheet" href="css/merits.css">
  <link rel="stylesheet" href="css/quiz.css">
  <link rel="stylesheet" href="css/popups.css">
  <link rel="stylesheet" href="css/overlay.css">
  <link rel="stylesheet" href="css/effects.css">
  <link rel="stylesheet" href="css/map.css">
  <link rel="stylesheet" href="css/placeCard.css">
  <link rel="stylesheet" href="css/footer.css">
  <link rel="stylesheet" href="css/sheets.css">

  <!-- Console CSS -->
  <link rel="stylesheet" href="js/console/console.css">

</head>

<body class="hg-app">

  <!-- Toast -->
  <div id="toast"></div>

  <!-- USYNLIGE DATA-CONTAINERE -->
  <div id="collectionGrid" style="display:none"></div>
  <div id="collectionCount" style="display:none"></div>
  <div id="gallery" style="display:none"></div>

  <!-- Badge-modal -->
  <div id="badgeModal" class="modal" aria-hidden="true" style="display:none;">
    <div class="modal-content">
      <img class="badge-img" src="" alt="Merke">
      <h3 class="badge-title"></h3>
      <p class="badge-level"></p>
      <div class="badge-progress"><div class="badge-progress-bar"></div></div>
      <p class="badge-progress-text"></p>
      <ul class="badge-quizzes"></ul>
      <button class="close-btn">Lukk</button>
    </div>
  </div>

<!-- HEADER -->
<header class="site-header">

  <img class="hg-brand" src="bilder/logo_historygo.PNG" alt="History GO">
  
  <div class="top-actions">

    <a id="miniProfile" class="miniProfileTop" href="profile.html" aria-label="Profil">
      <span id="miniName" class="mpt-name">Utforsker #182</span>

      <span class="mpt-badges" aria-label="Merker">
        <span class="mpt-badgeIcon" aria-hidden="true"></span>
        <span id="linkBadges" class="mpt-count">0</span>
      </span>

      <div class="mp-extra" aria-hidden="true">
        <p id="miniStats" class="muted">
          <span id="linkPlaces" class="linkish">0 steder</span>
          <span id="linkQuiz" class="linkish">0 quizzer</span>
        </p>

        <div id="miniBadges" class="profile-badges"></div>

        <div id="miniLastQuiz" class="profile-last-quiz" style="display:none;">
          <img id="miniLastQuizImg" src="">
          <span id="miniLastQuizName"></span>
        </div>
      </div>
    </a>
    
    <button id="btnSeeMap" class="iconbtn" type="button" aria-label="Kartmodus" title="Kartmodus">âŒ–</button>

    <input id="globalSearch" type="search" placeholder="SÃ¸kâ€¦" autocomplete="off">

    <span id="geoStatus" class="geo-status geo-unknown" title="Posisjonstatus">â€¦</span>

    <button id="btnUnlockAll" class="iconbtn" type="button" aria-label="Unlock all" title="Unlock all">ðŸ”“</button>
      
    <label class="toggle">
      <input id="openToggle" type="checkbox" />
      <span></span>
    </label>

  </div>

  <div id="searchResults"></div>

</header>


<!-- APP SHELL -->
<div class="app-shell">
  
  <!-- KART -->
  <div id="map" aria-label="Kart"></div>

  <div class="map-controls">
    <button id="btnCenter" title="Sentrer">âŒ–</button>
    <button id="btnExitMap" title="Lukk kart" aria-label="Lukk kart">âœ•</button>
  </div>

  <!-- nearbylistcontainer -->
  <div id="nearbyListContainer" class="leftpanel">

    <div class="leftpanel-head">
      <div class="leftpanel-title">Utforsk</div>

      <div class="nearby-row1">
        <div class="nearby-tabs" role="tablist" aria-label="Utforsk">

          <button id="nearbyFilterBtn"
                  class="nearby-filter-icon"
                  type="button"
                  aria-label="Filter"></button>

          <button class="nearby-tab is-active"
                  data-leftmode="nearby"
                  type="button">Steder</button>

          <button class="nearby-tab"
                  data-leftmode="people"
                  type="button">Folk</button>

          <button class="nearby-tab"
                  data-leftmode="nature"
                  type="button">Natur</button>

          <button class="nearby-tab"
                  data-leftmode="routes"
                  type="button">Ruter</button>

          <button class="nearby-tab"
                  data-leftmode="badges"
                  type="button">Merker</button>

        </div>

        <select id="leftPanelMode"
                class="leftpanel-select"
                aria-label="Velg visning"
                style="display:none">
          <option value="nearby" selected>NÃ¦rmeste</option>
          <option value="people">Folk</option>
          <option value="nature">Natur</option>
          <option value="routes">Ruter</option>
          <option value="badges">Merker</option>
        </select>

      </div>
    </div>

    <div class="leftpanel-body">
      <section id="panelNearby" class="leftpanel-view">
        <div id="status" class="muted" style="display:none">Henter posisjonâ€¦</div>
        <div class="nearby-row2">
          <div id="nearbyList" class="nearby-strip"></div>
        </div>
      </section>

      <section id="panelPeople" class="leftpanel-view" style="display:none;">
        <div id="leftPeopleList" class="leftpanel-list"></div>
      </section>

      <section id="panelNature" class="leftpanel-view" style="display:none;">
        <div id="leftNatureList" class="leftpanel-list"></div>
      </section>

      <section id="panelRoutes" class="leftpanel-view" style="display:none;">
        <div id="leftRoutesList" class="leftpanel-list"></div>
      </section>

      <section id="panelBadges" class="leftpanel-view" style="display:none;">
        <div id="leftBadgesList" class="leftpanel-list"></div>
      </section>

    </div>
  </div>

  <!-- PLACE CARD -->
  <div id="placeCard" aria-hidden="true">
<div class="pc-body">

  <!-- Tekst Ã¸verst -->
  <div class="pc-text">
    <h2 id="pcTitle"></h2>
    <div id="pcMeta" class="pc-meta"></div>
    <p id="pcDesc" class="pc-desc"></p>
  </div>

  <!-- 2x2 Grid -->
  <div class="pc-grid">

    <!-- 1: FrontcardImage -->
    <div class="pc-frontcard">
      <img id="pcFrontImage" src="" alt="">
    </div>

    <!-- 3: Ikon-kvadrat -->
    <div class="pc-quad pc-icons-quad">
      <div id="pcPeopleIcon" class="pc-round"></div>
      <div id="pcNatureIcon" class="pc-round"></div>
      <div id="pcFloraIcon" class="pc-round"></div>
      <div id="pcBadgesIcon" class="pc-round"></div>
    </div>

    <!-- 2: CardImage -->
    <div class="pc-cardimage">
      <img id="pcCardImage" src="" alt="">
    </div>

    <!-- 4: Actions-kvadrat -->
    <div class="pc-quad pc-events-quad" id="pcEventsBox" aria-label="Det som skjer her">
     <div class="pc-events-head">
      <span class="pc-events-title">PÃ¥ stedet</span>
      <button id="pcAddEvent" class="pc-events-add" type="button" aria-label="Legg til">ï¼‹</button>
    </div>

  <div id="pcEvents" class="pc-events-list"></div>
</div>

  </div>

</div>

</div>


<!-- GLOBAL FOOTER -->
<div class="app-footer">

  <!-- ðŸ”¹ MINI PLACE CARD (NY) -->
  <div id="pcMini" class="pc-mini" aria-hidden="true">
    <img id="pcMiniImg" alt="">
  </div>

  <!-- ðŸ”¹ ACTIONS -->
  <div class="app-actions">
    <button id="pcInfo" class="secondary">Mer info</button>
    <button id="pcQuiz" class="primary">Ta quiz</button>
    <button id="pcUnlock" class="primary">LÃ¥s opp</button>

    <button id="pcRoute" class="iconbtn" aria-label="Rute"></button>
    <button id="pcObserve" class="iconbtn" aria-label="Observer"></button>
    <button id="pcNote" class="iconbtn" aria-label="Notat"></button>
  </div>

</div>

<div id="mpNextUp" class="app-nextup"></div>
  
  <!-- SERVICE WORKER -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        const base = location.pathname.replace(/\/[^\/]*$/, "/");
        navigator.serviceWorker.register(base + "sw.js");
      });
    }
  </script>


  
  <!-- MapLibre JS: MÃ… fÃ¸r map.js -->
<link
  href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css"
  rel="stylesheet"
/>

<script
  src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"
  crossorigin="anonymous">
</script>

<script>
  window.addEventListener("error", (e) => {
    console.log("[GLOBAL ERROR]", {
      message: e.message,
      filename: e.filename,
      lineno: e.lineno,
      colno: e.colno
    });
  });

  window.addEventListener("unhandledrejection", (e) => {
    console.log("[UNHANDLED REJECTION]", e.reason);
  });

</script>

<!-- ======================================================
     EKSTERNE / STÃ˜TTE
====================================================== -->
<script src="js/ui/popup-utils.js"></script>
<script src="js/ui/place-card.js"></script>
<script src="js/hgchips.js" defer></script>

<script src="js/knowledge.js"></script>
<script src="js/knowledge_component.js"></script>
<script src="js/trivia.js"></script>
<script src="js/hgInsights.js"></script>
<script src="js/dataHub.js"></script>

<script src="js/domainRegistry.js"></script>
<script src="js/domainHealthReport.js"></script>

<!-- ======================================================
     DEV / CONSOLE
====================================================== -->
<script src="js/console/init.js"></script>
<script src="js/console/verify.js"></script>
<script src="js/console/diagnosticConsole.js"></script>
<script src="js/console/devConsole.js"></script>
<script src="js/console/legacyExtensions.js"></script>

<script src="js/audits/missingImages.audit.js"></script>

<!-- ======================================================
     OBSERVATIONS
====================================================== -->
<script src="js/observations.js"></script>
<script src="js/observationsView.js"></script>

<!-- ======================================================
     CORE (ingen DOM, ingen side-effekter)
====================================================== -->
<script src="js/core/state.js"></script>
<script src="js/core/persistence.js"></script>
<script src="js/core/openmode.js"></script>
<script src="js/core/core.js"></script>
<script src="js/core/categories.js"></script>
<script src="js/core/badges.js"></script>
<script src="js/core/tiersCivi.js"></script>

<script src="js/ui/geo-indicator.js"></script>

<!-- ======================================================
     GEO / MAP
====================================================== -->
<script src="js/core/pos.js"></script>
<script src="js/map.js"></script>

<script src="js/ors-config.js"></script>
<script src="js/navRoutes.js"></script>

<!-- ======================================================
     GAME / PROGRESSION
====================================================== -->
<script src="js/hg_unlocks.js"></script>
<script src="js/quizzes.js"></script>
<script src="js/quiz-audit.js"></script>

<!-- ======================================================
     UI â€“ DOM + INTERAKSJON
====================================================== -->
<script src="js/ui/dom.js"></script>
<script src="js/ui/toast.js"></script>

<script src="js/ui/events.js"></script>
<script src="js/ui/interactions.js"></script>
<script src="js/ui/lists.js"></script>

<script src="js/ui/left-panel.js"></script>
<script src="js/ui/badges.js"></script>
<script src="js/ui/badge-modal.js"></script>
<script src="js/ui/mini-profile.js"></script>
<script src="js/ui/civication-inbox.js"></script>

<!-- ======================================================
     BOOT (kobler alt)
====================================================== -->
<script src="js/boot.js"></script>

<!-- ======================================================
     APP â€“ SIST, ALLTID
====================================================== -->
<script src="js/app.js"></script>

  
  <script>
    // Tving linkBadges til Ã¥ vÃ¦re kun tall (app.js kan skrive "12 merker")
  (function(){
    const el = document.getElementById("linkBadges");
    if(!el) return;

    function normalize(){
      const txt = (el.textContent || "").trim();
      const m = txt.match(/\d+/);
      el.textContent = m ? m[0] : "0";
    }

    // run now + hold it stable hvis app.js endrer igjen
    normalize();
    const obs = new MutationObserver(normalize);
    obs.observe(el, { childList:true, characterData:true, subtree:true });
  })();
</script>

<script>


  function setGeo(status) {
    const el = document.getElementById("geoStatus");
    if (!el) return;

    el.classList.remove("geo-ok","geo-bad","geo-unknown");

    if (status === "granted" || status === "test") {
      el.classList.add("geo-ok"); el.textContent = "ðŸ“";
    } else if (status === "blocked" || status === "unsupported") {
      el.classList.add("geo-bad"); el.textContent = "â›”";
    } else {
      el.classList.add("geo-unknown"); el.textContent = "â€¦";
    }
  }

  window.addEventListener("hg:geo", (e) => {
    const st = e?.detail?.status || "unknown";
    setGeo(st);
  });


</script>


<script src="js/routes.js"></script>
</body>
</html>
